<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
</head>
<body>
    <div class="popup" id="popup">
        <h2>Cập nhật ảnh đại diện</h2>
        <p>Chọn ảnh mới để làm ảnh đại diện của bạn.</p>
        <div class="change-avt" id="popupBtn">
          <img alt="" id="avatarPreview" src="./assets/img/<?php echo $avt; ?>">
        </div>
        <div class="btn-popup-change-avt">
          <form id="uploadForm" action="index.php?danhmuc=profile" method="post" enctype="multipart/form-data">
            <input type="file" id="avatarInput" name="hinhAnhAvt" style="display: none;">
            <button type="button" id="openBtn">Chọn ảnh</button>
            <button type="button" id="closeBtn">Đóng</button>
            <input type="submit" name="submit" id="submitBtn" style="display: none;">
          </form>
        </div>
      </div>
      
      <script>
      $(document).ready(function() {
        // Mở dialog chọn ảnh khi click nút "Chọn ảnh"
        $("#openBtn").click(function() {
          $("#avatarInput").trigger("click");
        });
      
        // Đóng popup khi click nút "Đóng"
        $("#closeBtn").click(function() {
          $("#popup").hide();
        });
      
        // Xử lý thay đổi ảnh và submit form bằng Ajax
        $("#avatarInput").change(function() {
          var formData = new FormData($("#uploadForm")[0]);
      
          $.ajax({
            url: "index.php?danhmuc=profile",
            type: "post",
            data: formData,
            contentType: false,
            processData: false,
            success: function(response) {
              if (response.success) {
                $("#avatarPreview").attr("src", response.url); // Cập nhật ảnh preview
                $("#popup").hide(); // Đóng popup khi thành công
              } else {
                alert(response.error); // Hiển thị thông báo lỗi
              }
            },
            error: function(jqXHR, textStatus, errorThrown) {
              console.error("Lỗi khi tải lên file:", textStatus, errorThrown); // Ghi lỗi vào console
              alert("Có lỗi xảy ra khi tải lên. Vui lòng thử lại."); // Thông báo cho người dùng
            }
          });
        });
      });
      </script>
    
    
</body>
</html>